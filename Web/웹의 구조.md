# 웹의 구조

태그: FTP, HTTP, HTTPS, SSL, WAS, 웹 서버

# 웹 서버

## 웹 서버의 역할

- 웹 서비스를 웹 클라이언트에게 제공
- 웹 브라우저가 HTTP 통신을 통해 데이터를 요청하면, 웹 서버가 데이터를 응답한다

## 웹 서버 소프트웨어

- Apache
- IIS

## 웹 서버에서 하는 처리

웹 서버의 처리는 요청한 URL에 지정된 파일이 정적 웹 컨텐츠를 만드는지, 동적 웹 컨텐츠를 만드는지에 따라 달라진다.

1. 정적 웹 컨텐츠의 처리
   - 정적 웹 컨텐츠 : 누군가가 변경하지 않는 한 똑같은 표시 내용을 반환하는 웹 컨텐츠
   - 웹 서버는 정적 웹 컨텐츠에 대한 요청을 받으면 미리 저장되어 있는 파일을 꺼내서 클라이언트에게 반환한다.
   - 가지고 있는 파일을 반환하는 것일 뿐이므로 속도가 빠르다.
   - 웹 컨텐츠에 실려있는 정보가 바뀔 때마다 대상 파일을 갱신할 필요가 있기 때문에 관리가 번거롭다.
2. 동적 웹 컨텐츠의 처리
   - 동적 웹 컨텐츠 : 클라이언트로부터 받은 정보에 따라 표시 내용이 달라지는 웹 컨텐츠
   - 웹 서버는 동적 웹 컨텐츠에 대한 요청을 받으면, 필요한 처리를 수행한 후 그 처리 결과를 클라이언트에게 반환한다.
   - 동적 컨텐츠를 생성하기 위한 수단
     - CGI
       - 모든 처리를 서버 측에서 수행
       - CGI의 처리 순서
         1. 클라이언트가 요청을 전송
         2. 서버는 요청받은 프로그램을 실행해 컨텐츠를 생성한다.
         3. 생성한 컨텐츠 데이터를 반환한다.
     - Web API
       - 페이지의 생성 처리를 클라이언트 측에서 수행하게 함
       - XML 형식이나 JSON 형식으로 받으면 그에 따른 처리를 수행하고,
         처리 결과를 요청 받은 형식과 똑같은 형식으로 반환한다.
       - 웹 브라우저는 받은 처리 결과를 바탕으로 동적 컨텐츠를 구성하여 표시한다.
       - Web API의 처리 순서
         1. 클라이언트가 요청을 전송
         2. 서버는 받은 데이터를 바탕으로 데이터를 생성
         3. 서버가 생성한 데이터를 클라이언트에 전송 (응답)
         4. 클라이언트는 받은 데이터를 바탕으로 컨텐츠를 생성한다.
   -

# HTTP/HTTPS와 SSL

## HTTP 통신

- 클라이언트/서버형 프로토콜 : 웹 서버가 웹 서비스를 웹 클라이언트에게 제공할 때 사용하는 프로토콜
- 웹 브라우저 — request : 메서드 + URL → 웹 서버
  - 메서드 : 서버에 대해 무엇을 하고 싶은지 나타낸다. (GET, POST, PATCH, DELETE)
  - URL : 목적하는 파일이나 프로그램(리소스)을 나타낸다.
    - 스킴명 : 웹 브라우저는 스킴명을 보고 사용할 프로토콜을 결정한다.
    - 호스트명
    - 도메인명
    - 웹 서버 상의 파일 경로

## HTTPS

HTTP over SSL

: HTTP를 SSL로 암호화한 프로토콜

### SSL 프로토콜

- 데이터를 암호하거나, 통신 상태를 인증함으로써 데이터를 보호한다.

### SSL 서버 소프트웨어

- OpenSSL : 일반적으로 웹 서버인 Apache에 모듈을 인스톨하여 Apache에 연계시켜 사용
- IIS : SSL 기능을 표준으로 갖추고 잇다.

⇒ 지원하는 플랫폼이나 애플리케이션이 다르다.

### SSL 기능

SSL은 데이터를 위협으로부터 보호한다

1. 암호화로 도청을 막는다.
   - 암호화 : 정해진 규칙에 근거해 데이터를 변환하는 기술
   - 제 3자가 데이터를 훔쳐보는 도청을 막을 수 있다.
   - 상세 과정
     1. 웹 브라우저에서 데이터를 암호화해서 보낸다
     2. 전송 과정에서 도청해도 내용을 알 수 없다
     3. SSL 서버에 암호화된 데이터가 도착하면, 데이터를 복원한다.
2. 메시지 다이제스트로 변조를 막는다.
   - 데이터로부터 고정 길이 데이터(해시값)를 꺼내는 계산
   - 데이터를 주고받을 때 송신측과 수신측에서 해시값을 계산해 그 값이 똑같으면 데이터가 바뀌지 않았다고 판단한다.
   - 상세 과정
     1. 웹 브라우저에서 메시지 다이제스트를 계산해 데이터와 함께 보낸다
     2. 데이터 전송 과정에서 데이터가 변조되면
     3. SSL 서버에서 다이제스트를 계산해 값이 다르면 변조되었다는 것을 안다.
3. 디지털 증명서로 위장을 막는다.
   - 제 3자가 데이터를 바꿔쓰는 변조를 방지할 수 있다
   - 디지털 증명서는 해당 컴퓨터가 진짜인질를 증명하는 파일이다.
   - 통신 상대가 진짜인지 확인함으로써, 위장을 방지할 수 있다.
   - 상세 과정
     1. 웹 브라우저가 SSL서버에 디지털 증명서를 요청한다
     2. SSL 서버에서 디지털 증명서를 송부한다
     3. 웹 브라우저에서 디지털 증명서를 보고 서버의 신원을 확인할 수 있다.

# FTP 서버

FTP 프로토콜을 이용해 파일을 효율적으로 전송하는 서버

## FTP 서비스를 제공하는 서버 소프트웨어

- Linux 플랫폼 : vsftpd, ProFTPD
- Windows 플랫폼 : IIS의 FTP 서버

# 웹 서버 / 웹 애플리케이션 서버

[웹서버와 WAS 차이](https://www.notion.so/WAS-3bc91bdb3502486e99597442d6c9e70b)

## 웹 서버

웹 서버는 작성된 html 페이지 등을 네트워크망에 종속되지 않고, 웹 서비스를 할 수 있도록 만든 어플리케이션

- 웹 서버 소프트웨어 : 웹 브라우저 클라이언트로부터 HTTP 요청을 받아들이고, HTML 문서와 같은 웹 페이지에서 흔히 찾아볼 수 있는 자료 컨텐츠에 따라 HTTP에 반응하는 컴퓨터 프로그램
- 웹 서버 하드웨어 : 위에 언급한 기능을 제공하는 컴퓨터 프로그램을 실행하는 컴퓨터

## 웹 애플리케이션 서버 WAS

웹 서버 + 웹 컨테이너

![WAS.png](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/9b43718f-fed2-4130-9ad6-c780043826ab/WAS.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220208%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220208T150016Z&X-Amz-Expires=86400&X-Amz-Signature=770508a1890f1d38bd59c12b3ae5445d6b505ccc24041306a7bf13f1c629bf31&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22WAS.png%22&x-id=GetObject)

- 인터넷 상에서 HTTP를 통해 사용자 컴퓨터나 장치에 애플리케이션을 수행해주는 미들웨어 (소프트웨어 엔진)
- 웹 애플리케이션 서버는 동적 서버 컨텐츠를 수행하는 것으로, 일반적인 웹 서버와 구별이 되며, 주로 데이터베이스 서버와 같이 수행이 된다.
- 웹 서버 + 웹 컨테이너로 웹 상에서 사용하는 컴포넌트를 올려놓고 사용하게 되는 서버
  - 웹 컨테이너 : JSP와 Servlet을 실행시킬 수 있는 소프트웨어

### 기본 기능

1. 프로그램 실행 환경과 데이터베이스 접속 기능을 제공
2. 여러 개의 트랜잭션을 관리
3. 업무를 처리하는 비즈니스 로직을 수행
4. Web Service 플랫폼으로서의 역할

### 웹 컨테이너

- JSP와 서블릿을 실행시킬 수 있는 소프트웨어를 웹 컨테이너 혹은 서블릿 컨테이너라고 한다.
- 웹 서버에서 JSP를 요청하면, 톰캣(웹 컨테이너)에서는 JSP 파일을 서블릿으로 변환하여 컴파일을 수행하고, 서블릿 수행결과를 웹 섭에게 전달하게 된다.
- JSP 컨테이너가 탑재되어 있는 WAS는 JSP 페이지를 컴파일해 동적인 페이지를 생성한다.
- 종류
  - Servlet 컨테이너
  - JSP 컨테이너
  - EJB 컨테이너

## WEB과 WAS의 종류

### apache

- 소프트웨어 단체 이름
- 우리가 흔히 부르는 아파치 서버 → 아파치 단체에서 후원하는 오픈소스 프로젝트 커뮤니티에서 만든 http 웹 서버
  - http 웹 서버 : http 요청을 처리할 수 있는 웹 서버
- 클라이언트가 요청을 하면, 아파치 서버가 어떤 결과를 돌려주는 기능을 한다.

### tomcat

- WAS
- 웹 서버와 웹 컨테이너의 결합으로, 다양한 기능을 컨테이너에 구현하여 다양한 역할을 수행할 수 있는 서버
- 클라이언트의 요청이 있을 때 : 내부의 프로그램을 통해 결과를 만들어내고, 이것을 다시 클라이언트에 전달해주는 역할을 하는 것이 웹 컨테이너
- 아파치 웹 서버와의 차이 → 컨테이너 기능이 가능한가?의 차이

## 웹 서버와 WAS의 비교

- 웹 컨테이너의 유무
  - 웹 서버는 웹 컨테이너가 X
  - WAS는 웹 컨테이너가 O
- 웹 서버 : HTML 문서같은 정적 컨텐츠 처리 (HTTP 프로토콜을 통해 읽힐 수 있는 문서)
  WAS : asp, php, jsp 등 개발 언어를 읽고 처리하여 동적 컨텐츠와 웹 응용 프로그램 서비스를 처리한다.

### 차이점

- 목적이 다르다.
- **웹 서버**는 정적인 데이터를 처리하는 서버
  이미지, 단순 html 파일과 같이 정적인 리소스를 제공하는 서버를 웹 서버로 사용하면 빠르고 안정적이다.
- **WAS**는 동적인 데이터를 처리하는 서버
  DB와 연결되어 데이터를 주고 받거나 프로그램으로 데이터 조작이 필요한 경우에는 WAS를 활용
  보통의 웹 페이지는 정적 컨텐츠와 동적 컨텐츠를 함께 노출한다.
  WAS가 정적 데이터를 처리하게 되면, 동적 컨텐츠의 처리가 지연이 될 것이고, 이로 인한 페이지 노출시간이 늘어나게 된다.
  WAS는 동적 처리에 최적화되어 있는 서비스이기 때문에, 정적 컨텐츠는 웹 서버에서 처리하고, 동적 컨텐츠는 WAS에서 처리한다.
- 사용자가 클라이언트에 요청 → 클라이언트가 웹 서버에 데이터를 요청 → 웹 서버에서 WAS에 요청을 전달 → WAS가 데이터를 처리 후 웹 서버로 전달 → 웹 서버가 클라이언트로 처리된 데이터를 응답 → 클라이언트가 데이터를 가지고 가공해서 사용자에게 보여줌
- JSP를 배울 때, 대체적으로 Apache와 Tomcat을 사용
  ASP를 구동하기 위해서는 IIS를 사용
  ASP의 환경이 MS계열 서비스라면 WAS를 담당하는 부분이 있어 WAS가 따로 필요하지 않다.

### 웹 서버와 WAS 구성에 따른 분류

1. **WAS와 웹 서버를 분리하지 않는 경우**
   - 모든 컨텐츠를 한 곳에 집중 → 웹 서버와 WAS 역할을 동시에 수행
   - 사용자가 많지 않거나 트래픽이 적을때 효율적
   - 개발 및 테스트 시스템 구성시 활용가치 높음
   - 장점 : 사용자가 증가하면 스위치 장비의 로드 밸런싱 수행
   - 단점 : WAS가 정적, 동적 처리를 같이 하므로 최적화에 좋지 않다.
2. **WAS와 웹 서버를 분리한 경우**
   - 웹 서버와 WAS의 기능적 분류를 통해 효과적인 분산을 유도
   - 정적인 데이터는 웹 서버에서 처리
     동적인 데이터는 WAS에서 처리
   - 아파치와 톰캣의 경우, 둘을 연동한다는 의미 = 같은 포트번호를 사용하게 한다.
     → 아파치가 웹 서버와 외부 서비스를 연동하기 위한 규약인 AJP로 통신
     → 이를 통해 서블릿을 필요로 하는 요청을 걸러서 톰캣으로 보냄
     (AJP 프로토콜을 사용해 연동하는 모듈로 mod_jk 사용)
3. **WAS 여러 개와 웹 서버를 분리한 경우**
   - WAS단을 프리젠테이션 로직과 비즈니스 로직으로 구분하여 구성
   - 특정 로직의 부하에 따라 적절한 대응할 수 있지만, 설계나 유지보수 단계가 복잡해질 수 있다.

**WAS와 웹 서버를 분리하는 이유?**

1. 기능을 분리하여 서버의 부하 방지
2. 물리적으로 분리하여 보안 강화
3. 여러 대의 WAS를 연결 가능 (로드밸런싱의 역할 및 fail over, fail back 처리에 유리)
4. 여러 웹 애플리케이션을 서비스 가능
   (Java 서버, c# 서버, PHP 서버 등 하나의 웹서비스를 통해 서비스 가능)
